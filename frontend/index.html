<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Powered In-game Text Translator</title>
    <!-- Favicon using Font Awesome icon as fallback -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåê</text></svg>">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        /* Base theme variables */
        .theme-light { --bg-primary: #ffffff; --text-primary: #111827; --bg-secondary: #f9fafb; --bg-tertiary: #f3f4f6; --border-color: #e5e7eb; --text-muted: #6b7280; --link-color: #4f46e5; }
        .theme-dark { --bg-primary: #1f2937; --text-primary: #f3f4f6; --bg-secondary: #374151; --bg-tertiary: #4b5563; --border-color: #4b5563; --text-muted: #9ca3af; --link-color: #818cf8; }
        .theme-yellow { --bg-primary: #fefce8; --text-primary: #422006; --bg-secondary: #fef9c3; --bg-tertiary: #fef3c7; --border-color: #fde68a; --text-muted: #7c2d12; --link-color: #c2410c; }
        .theme-grey { --bg-primary: #f3f4f6; --text-primary: #222222; --bg-secondary: #e5e7eb; --bg-tertiary: #d1d5db; --border-color: #9ca3af; --text-muted: #6b7280; --link-color: #374151; }
        .theme-teal { --bg-primary: #f0fdfa; --text-primary: #134e4a; --bg-secondary: #ccfbf1; --bg-tertiary: #99f6e4; --border-color: #5eead4; --text-muted: #0f766e; --link-color: #0d9488; }
        .theme-lavender { --bg-primary: #f5f3ff; --text-primary: #4c1d95; --bg-secondary: #ede9fe; --bg-tertiary: #ddd6fe; --border-color: #c4b5fd; --text-muted: #6d28d9; --link-color: #7c3aed; }
        .theme-cyberpunk-magenta {
            --bg-primary: #120018;
            --text-primary: #ff33ff;
            --bg-secondary: #1a002a;
            --bg-tertiary: #2a003a;
            --border-color: #ff00cc;
            --text-muted: #ff99ff;
            --link-color: #00fff7;
        }
        .theme-cyberpunk-red {
            --bg-primary: #120008;
            --text-primary: #ff3333;
            --bg-secondary: #1a000a;
            --bg-tertiary: #2a001a;
            --border-color: #ff2222;
            --text-muted: #ff8888;
            --link-color: #ff3333;
        }
        .theme-cyberpunk-cyan {
            --bg-primary: #061826;
            --text-primary: #00fff7;
            --bg-secondary: #0a2233;
            --bg-tertiary: #112d44;
            --border-color: #00fff7;
            --text-muted: #ff33ff;
            --link-color: #00bfff;
        }

        body { 
            background-color: var(--bg-primary); 
            color: var(--text-primary); 
            transition: all 0.3s ease; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .card { 
            background-color: var(--bg-secondary); 
            border: 1px solid var(--border-color); 
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            margin-bottom: 1rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .tab { 
            padding: 0.75rem 1.25rem; 
            cursor: pointer; 
            border-bottom: 2px solid transparent; 
            color: var(--text-muted); 
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tab:hover {
            color: var(--link-color);
            background-color: rgba(0, 0, 0, 0.04);
        }
        
        .tab.active { 
            border-bottom-color: var(--link-color); 
            color: var(--text-primary); 
            font-weight: 600; 
        }
        
        label { 
            color: var(--text-muted); 
            font-weight: 500;
        }
        
        input, select, textarea { 
            background-color: var(--bg-primary) !important; 
            border-color: var(--border-color) !important; 
            color: var(--text-primary) !important; 
            border-radius: 0.5rem !important;
            transition: all 0.2s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2) !important;
        }
        
        textarea:disabled { 
            background-color: var(--bg-tertiary) !important; 
            opacity: 0.7;
        }
        
        pre { 
            background-color: var(--bg-tertiary); 
            padding: 0.75rem; 
            border-radius: 0.5rem; 
            border: 1px solid var(--border-color); 
            white-space: pre-wrap; 
            word-wrap: break-word; 
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        /* Button styles */
        button {
            transition: all 0.2s ease;
        }
        
        button:hover {
            transform: translateY(-1px);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        /* Modern spinner */
        .spinner { 
            border: 3px solid rgba(0, 0, 0, 0.1); 
            border-radius: 50%; 
            border-top: 3px solid var(--link-color); 
            width: 1.5rem; 
            height: 1.5rem; 
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        /* Tab animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Remove cyberpunk glowing effects */
        .theme-cyberpunk-cyan .card, 
        .theme-cyberpunk-cyan .tab, 
        .theme-cyberpunk-cyan input, 
        .theme-cyberpunk-cyan select, 
        .theme-cyberpunk-cyan textarea, 
        .theme-cyberpunk-cyan pre,
        .theme-cyberpunk-magenta .card, 
        .theme-cyberpunk-magenta .tab, 
        .theme-cyberpunk-magenta input, 
        .theme-cyberpunk-magenta select, 
        .theme-cyberpunk-magenta textarea, 
        .theme-cyberpunk-magenta pre,
        .theme-cyberpunk-red .card, 
        .theme-cyberpunk-red .tab, 
        .theme-cyberpunk-red input, 
        .theme-cyberpunk-red select, 
        .theme-cyberpunk-red textarea, 
        .theme-cyberpunk-red pre {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border-color) !important;
            background-color: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
            text-shadow: none;
        }
        
        .theme-cyberpunk-cyan label,
        .theme-cyberpunk-magenta label,
        .theme-cyberpunk-red label {
            color: var(--text-muted) !important;
            text-shadow: none;
        }
        
        .theme-cyberpunk-cyan .tab.active,
        .theme-cyberpunk-magenta .tab.active,
        .theme-cyberpunk-red .tab.active {
            border-bottom-color: var(--link-color);
            color: var(--link-color);
            font-weight: 600;
            text-shadow: none;
        }
        
        .theme-cyberpunk-cyan body,
        .theme-cyberpunk-magenta body,
        .theme-cyberpunk-red body {
            background-image: none;
        }
        
        /* Footer */
        .footer {
            margin-top: 2rem;
            padding: 1.5rem;
            text-align: center;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.875rem;
        }
        
        .footer a {
            color: var(--link-color);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body x-data="translationApp()" x-init="init()" :class="`theme-${theme}`" class="p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Application Header -->
        <div class="mb-6">
            <h1 class="text-3xl font-bold text-center mb-6">
                <i class="fas fa-language mr-2"></i> LLM Powered In-game Text Translator
            </h1>
            
            <!-- Main Navigation Tabs -->
            <div class="flex items-center justify-between border-b border-[var(--border-color)] mb-6">
                <nav class="-mb-px flex space-x-2 overflow-x-auto" aria-label="Main Navigation">
                    <button
                        @click="viewMode = 'home'"
                        :class="{
                            'border-[var(--link-color)] text-[var(--text-primary)] font-semibold bg-[var(--bg-tertiary)]': viewMode === 'home',
                            'border-transparent text-[var(--text-muted)] hover:text-[var(--link-color)] hover:border-gray-300': viewMode !== 'home'
                        }"
                        class="py-3 px-4 border-b-2 font-medium text-sm rounded-t-md transition-colors duration-200 ease-in-out focus:outline-none flex items-center gap-2"
                    >
                        <i class="fas fa-home"></i> Home
                    </button>
                    <button
                        @click="viewMode = 'form'; resetTranslation()"
                        :class="{
                            'border-[var(--link-color)] text-[var(--text-primary)] font-semibold bg-[var(--bg-tertiary)]': viewMode === 'form',
                            'border-transparent text-[var(--text-muted)] hover:text-[var(--link-color)] hover:border-gray-300': viewMode !== 'form'
                        }"
                        class="py-3 px-4 border-b-2 font-medium text-sm rounded-t-md transition-colors duration-200 ease-in-out focus:outline-none flex items-center gap-2"
                    >
                        <i class="fas fa-plus-circle"></i> New Translation
                    </button>
                    <button
                        @click="viewMode = 'glossary'; loadUserGlossaries()"
                        :class="{
                            'border-[var(--link-color)] text-[var(--text-primary)] font-semibold bg-[var(--bg-tertiary)]': viewMode === 'glossary',
                            'border-transparent text-[var(--text-muted)] hover:text-[var(--link-color)] hover:border-gray-300': viewMode !== 'glossary'
                        }"
                        class="py-3 px-4 border-b-2 font-medium text-sm rounded-t-md transition-colors duration-200 ease-in-out focus:outline-none flex items-center gap-2"
                    >
                        <i class="fas fa-book"></i> Glossary Management
                    </button>
                    <button
                        @click="showJobHistory()"
                        :class="{
                            'border-[var(--link-color)] text-[var(--text-primary)] font-semibold bg-[var(--bg-tertiary)]': viewMode === 'history',
                            'border-transparent text-[var(--text-muted)] hover:text-[var(--link-color)] hover:border-gray-300': viewMode !== 'history'
                        }"
                        class="py-3 px-4 border-b-2 font-medium text-sm rounded-t-md transition-colors duration-200 ease-in-out focus:outline-none flex items-center gap-2"
                    >
                        <i class="fas fa-history"></i> Job History
                    </button>
                    <button
                        @click="viewMode = 'llm-config'"
                        :class="{
                            'border-[var(--link-color)] text-[var(--text-primary)] font-semibold bg-[var(--bg-tertiary)]': viewMode === 'llm-config',
                            'border-transparent text-[var(--text-muted)] hover:text-[var(--link-color)] hover:border-gray-300': viewMode !== 'llm-config'
                        }"
                        class="py-3 px-4 border-b-2 font-medium text-sm rounded-t-md transition-colors duration-200 ease-in-out focus:outline-none flex items-center gap-2"
                    >
                        <i class="fas fa-cogs"></i> Configuration
                    </button>
                </nav>
                <div class="flex items-center ml-4">
                    <label for="theme-select" class="text-sm font-medium mr-2">
                        <i class="fas fa-paint-brush mr-1"></i> Theme:
                    </label>
                    <select id="theme-select" x-model="theme" class="pl-3 pr-10 py-2 text-base border focus:ring focus:ring-opacity-50 sm:text-sm rounded-md">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="yellow">Yellow</option>
                        <option value="grey">Grey</option>
                        <option value="teal">Teal</option>
                        <option value="lavender">Lavender</option>
                        <option value="cyberpunk-magenta">Cyberpunk - Magenta</option>
                        <option value="cyberpunk-red">Cyberpunk - Red</option>
                        <option value="cyberpunk-cyan">Cyberpunk - Cyan</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Home View -->
        <div x-show="viewMode === 'home'" class="tab-content">
            <div class="card p-8">
                <h2 class="text-2xl font-bold mb-6 text-center">Translation Statistics</h2>
                
                <!-- Statistics Dashboard -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Total Jobs -->
                    <div class="bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-800 dark:to-blue-900 rounded-lg p-6 shadow-md transform transition-transform hover:scale-105">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-blue-800 dark:text-blue-200">Total Jobs</h3>
                            <div class="text-3xl text-blue-600 dark:text-blue-300">
                                <i class="fas fa-tasks"></i>
                            </div>
                        </div>
                        <p class="text-3xl font-bold text-blue-900 dark:text-blue-100" x-text="jobStats.totalJobs || 0"></p>
                        <p class="text-sm text-blue-700 dark:text-blue-300 mt-2">Translation jobs</p>
                    </div>
                    
                    <!-- Translated Words & Characters -->
                    <div class="bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-800 dark:to-purple-900 rounded-lg p-6 shadow-md transform transition-transform hover:scale-105">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-purple-800 dark:text-purple-200">Translated Words & Characters</h3>
                            <div class="text-3xl text-purple-600 dark:text-purple-300">
                                <i class="fas fa-font"></i>
                            </div>
                        </div>
                        <div class="flex justify-between">
                            <div>
                                <p class="text-3xl font-bold text-purple-900 dark:text-purple-100" x-text="jobStats.totalWords.toLocaleString() || 0"></p>
                                <p class="text-sm text-purple-700 dark:text-purple-300">Words</p>
                            </div>
                            <div>
                                <p class="text-3xl font-bold text-purple-900 dark:text-purple-100" x-text="jobStats.totalChars.toLocaleString() || 0"></p>
                                <p class="text-sm text-purple-700 dark:text-purple-300">Characters</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Translation Mode -->
                    <div class="bg-gradient-to-br from-green-100 to-green-200 dark:from-green-800 dark:to-green-900 rounded-lg p-6 shadow-md transform transition-transform hover:scale-105">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-green-800 dark:text-green-200">Translation Mode</h3>
                            <div class="text-3xl text-green-600 dark:text-green-300">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                        </div>
                        <div class="relative pt-1">
                            <div class="flex mb-2 items-center justify-between">
                                <div>
                                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200 dark:text-green-200 dark:bg-green-700">
                                        Deep
                                    </span>
                                </div>
                                <div>
                                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200 dark:text-green-200 dark:bg-green-700">
                                        Quick
                                    </span>
                                </div>
                            </div>
                            <div class="overflow-hidden h-4 mb-2 text-xs flex rounded bg-green-200 dark:bg-green-700">
                                <div :style="`width: ${jobStats.deepTranslationPercent}%`" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-600 dark:bg-green-400 transition-all duration-500"></div>
                            </div>
                            <div class="flex justify-between text-xs text-green-800 dark:text-green-200">
                                <span x-text="`${jobStats.deepTranslationPercent}%`"></span>
                                <span x-text="`${100 - jobStats.deepTranslationPercent}%`"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <!-- Top Models -->
                    <div class="bg-gradient-to-br from-amber-100 to-amber-200 dark:from-amber-800 dark:to-amber-900 rounded-lg p-6 shadow-md transform transition-transform hover:scale-105">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-amber-800 dark:text-amber-200">Top Models</h3>
                            <div class="text-3xl text-amber-600 dark:text-amber-300">
                                <i class="fas fa-robot"></i>
                            </div>
                        </div>
                        <ul class="space-y-2">
                            <template x-for="(model, index) in jobStats.topModels" :key="index">
                                <li class="flex justify-between items-center">
                                    <span class="text-amber-900 dark:text-amber-100 font-medium" x-text="model.name"></span>
                                    <span class="text-amber-700 dark:text-amber-300 text-sm" x-text="`${model.count} jobs`"></span>
                                </li>
                            </template>
                            <li x-show="!jobStats.topModels.length" class="text-amber-700 dark:text-amber-300">No data available</li>
                        </ul>
                    </div>
                    
                    <!-- Top Accents/Styles -->
                    <div class="bg-gradient-to-br from-rose-100 to-rose-200 dark:from-rose-800 dark:to-rose-900 rounded-lg p-6 shadow-md transform transition-transform hover:scale-105">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-rose-800 dark:text-rose-200">Top Accents/Styles</h3>
                            <div class="text-3xl text-rose-600 dark:text-rose-300">
                                <i class="fas fa-microphone-alt"></i>
                            </div>
                        </div>
                        <ul class="space-y-2">
                            <template x-for="(accent, index) in jobStats.topAccents" :key="index">
                                <li class="flex justify-between items-center">
                                    <span class="text-rose-900 dark:text-rose-100 font-medium" x-text="accent.name"></span>
                                    <span class="text-rose-700 dark:text-rose-300 text-sm" x-text="`${accent.count} jobs`"></span>
                                </li>
                            </template>
                            <li x-show="!jobStats.topAccents.length" class="text-rose-700 dark:text-rose-300">No data available</li>
                        </ul>
                    </div>
                    
                    <!-- Top Languages -->
                    <div class="bg-gradient-to-br from-cyan-100 to-cyan-200 dark:from-cyan-800 dark:to-cyan-900 rounded-lg p-6 shadow-md transform transition-transform hover:scale-105">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-cyan-800 dark:text-cyan-200">Top Languages</h3>
                            <div class="text-3xl text-cyan-600 dark:text-cyan-300">
                                <i class="fas fa-globe"></i>
                            </div>
                        </div>
                        <ul class="space-y-2">
                            <template x-for="(lang, index) in jobStats.topLanguages" :key="index">
                                <li class="flex justify-between items-center">
                                    <span class="text-cyan-900 dark:text-cyan-100 font-medium" x-text="lang.name"></span>
                                    <span class="text-cyan-700 dark:text-cyan-300 text-sm" x-text="`${lang.count} jobs`"></span>
                                </li>
                            </template>
                            <li x-show="!jobStats.topLanguages.length" class="text-cyan-700 dark:text-cyan-300">No data available</li>
                        </ul>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="p-6 bg-[var(--bg-tertiary)] rounded-lg">
                        <div class="text-3xl mb-4 text-blue-500">
                            <i class="fas fa-book"></i>
                        </div>
                        <h3 class="font-semibold mb-2">Translate Books</h3>
                        <p class="text-[var(--text-muted)]">Upload file or paste text to translate, You can upload an entire game text (e.g: 200,000 word book), we will translate it while maintaining structure and formatting. currently (.md) and (.txt) supportted </p>
                    </div>
                    
                    <div class="p-6 bg-[var(--bg-tertiary)] rounded-lg">
                        <div class="text-3xl mb-4 text-green-500">
                            <i class="fas fa-book-reader"></i>
                        </div>
                        <h3 class="font-semibold mb-2">Understand Context</h3>
                        <p class="text-[var(--text-muted)]">LLMs (Large Language Models) understand the meaning and deep ideas in context across paragraphs for accurate and deep translations.</p>
                    </div>
                    
                    <div class="p-6 bg-[var(--bg-tertiary)] rounded-lg">
                        <div class="text-3xl mb-4 text-purple-500">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <h3 class="font-semibold mb-2">Custom Glossaries</h3>
                        <p class="text-[var(--text-muted)]">Create and manage your own glossaries to ensure consistent terminology throughout your translations. or leave it to LLM model to automatically build a unified glossary accross the text/book</p>
                    </div>
                </div>
                
                <div class="text-center">
                    <button @click="viewMode = 'form'; resetTranslation()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-md shadow-md transition-all duration-200 transform hover:-translate-y-1">
                        <i class="fas fa-plus-circle mr-2"></i> Start New Translation
                    </button>
                </div>
            </div>
        </div>
        
        <!-- New Translation Form View -->
        <div x-show="viewMode === 'form'" class="grid grid-cols-1 lg:grid-cols-3 gap-6 tab-content">
            <!-- Left Column: Configuration & Input -->
            <div class="lg:col-span-1 space-y-4">
                <div class="card">
                    <h2 class="text-xl font-semibold mb-3">
                        <i class="fas fa-cog mr-2"></i> Translation Settings
                    </h2>
                    <div class="space-y-3">
                        <div>
                            <label for="source_lang" class="block text-sm font-medium">
                                <i class="fas fa-globe-americas mr-1"></i> Source Language:
                            </label>
                            <input type="text" id="source_lang" x-model="inputData.config.source_lang" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="e.g., english">
                        </div>
                        <div>
                            <label for="target_lang" class="block text-sm font-medium">
                                <i class="fas fa-globe-europe mr-1"></i> Target Language:
                            </label>
                            <input type="text" id="target_lang" x-model="inputData.config.target_lang" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="e.g., arabic">
                        </div>
                        <div>
                            <label for="target_accent" class="block text-sm font-medium">
                                <i class="fas fa-microphone-alt mr-1"></i> Target Style/Accent:
                            </label>
                            <input type="text" id="target_accent" x-model="inputData.config.target_language_accent" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="e.g., professional, Egyptian Arabic">
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h2 class="text-xl font-semibold mb-3">
                        <i class="fas fa-book mr-2"></i> Glossary Selection
                    </h2>
                    <div>
                        <label for="glossary_select" class="block text-sm font-medium">Select Glossary:</label>
                        <select id="glossary_select" x-model="selectedGlossaryId" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm">
                            <option value="none">Automatic Terminology Extraction</option>
                            <template x-for="glossary in userGlossaries" :key="glossary.glossary_id">
                                <option :value="glossary.glossary_id" x-text="glossary.name + (glossary.is_default ? ' (Default)' : '')"></option>
                            </template>
                        </select>
                        <p class="mt-1 text-xs text-[var(--text-muted)]">Select a saved glossary or choose "Automatic Terminology Extraction". This option will automatically unify all technical terms and names across the translated file. If you wish to use custom glossary table or dictionary list go to "Glossary Management" tab to create or upload one</p>
                        <p class="mt-1 text-xs text-indigo-600" x-show="selectedGlossaryId === ''">Using: Default Glossary (if available)</p>
                        <p class="mt-1 text-xs text-orange-600" x-show="selectedGlossaryId === 'none'">Using: Automatic Term Extraction</p>
                        <template x-if="selectedGlossaryId && selectedGlossaryId !== 'none'">
                             <p class="mt-1 text-xs text-green-600">Using: <span x-text="userGlossaries.find(g => g.glossary_id === selectedGlossaryId)?.name || 'Selected Glossary'"></span></p>
                        </template>
                    </div>
                </div>
                <div class="card">
                    <h2 class="text-xl font-semibold mb-3">
                        <i class="fas fa-file-alt mr-2"></i> Input Content
                    </h2>
                     <div>
                        <label for="file-upload" class="block text-sm font-medium mb-1">
                            <i class="fas fa-upload mr-1"></i> Upload File (.md, .txt, .csv, .srt):
                        </label>
                        <input id="file-upload" type="file" @change="handleFileUpload($event)" accept=".md,.markdown,.txt,.csv,.srt" class="block w-full text-sm text-[var(--text-muted)] file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[var(--bg-tertiary)] file:text-[var(--text-primary)] hover:file:bg-opacity-80">
                        <p x-show="originalFilename" class="mt-1 text-sm text-[var(--text-muted)]">Selected file: <span x-text="originalFilename"></span></p>
                    </div>
                    <div class="mt-2">
                        <label for="original_content" class="block text-sm font-medium">
                            <i class="fas fa-keyboard mr-1"></i> Or Paste Text:
                        </label>
                        <textarea id="original_content" x-model="inputData.original_content" rows="15" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="Paste your text here or upload a file..."></textarea>
                    </div>
                    <button @click="startTranslation" :disabled="isLoading || !canStartTranslation()" class="mt-4 w-full inline-flex justify-center items-center py-3 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200">
                        <span x-show="!isLoading"><i class="fas fa-play mr-2"></i> Start Translation</span>
                        <div x-show="isLoading" class="spinner mr-2"></div>
                        <span x-show="isLoading">Translating...</span>
                    </button>
                </div>
            </div>
            <!-- Right Column: Status & Results -->
            <div class="lg:col-span-2 space-y-4">
                <div class="card" x-show="jobId || isLoading">
                    <h2 class="text-xl font-semibold mb-3">
                        <i class="fas fa-tasks mr-2"></i> Translation Status
                    </h2>
                    <div x-show="jobId">
                        <span class="text-sm text-[var(--text-muted)]">Job ID:</span> 
                        <code class="text-sm bg-[var(--bg-tertiary)] px-2 py-1 rounded" x-text="jobId"></code>
                    </div>
                    <div x-show="isLoading || status.progress_percent > 0">
                        <p class="mb-1 mt-2">Completed Step: <strong x-text="status.current_step || (isLoading ? 'Initializing...' : 'Done')"></strong></p>
                        <!-- Translation Stage Graph -->
                        <div class="w-full bg-[var(--bg-tertiary)] rounded-full h-2.5 mb-2 overflow-hidden">
                            <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" :style="`width: ${status.progress_percent || 0}%`"></div>
                        </div>
                        <p class="text-sm text-right mb-2"><span x-text="status.progress_percent ? status.progress_percent.toFixed(1) : '0.0'"></span>%</p>
                        <p class="text-sm" x-show="status.final_document || status.error_info">Duration: <span x-text="translationDuration"></span></p>
                    </div>
                     <div x-show="status.error_info" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
                        <h3 class="text-md font-semibold mb-1"><i class="fas fa-exclamation-triangle mr-1"></i> Error:</h3>
                        <p class="text-sm" x-text="status.error_info"></p>
                    </div>
                </div>
                <template x-if="isLoading || status.final_document">
                    <div>
                        <!-- Results Card Header (only for downloads, shown when translation is complete) -->
                        <div class="card" x-show="status.final_document">
                            <div class="flex justify-between items-center mb-3">
                                 <h2 class="text-xl font-semibold"><i class="fas fa-check-circle text-green-500 mr-2"></i> Results</h2>
                                 <div class="flex space-x-2">
                                     <button @click="downloadTranslation(jobId)" class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all">
                                         <i class="fas fa-download mr-1"></i> Download Translation
                                     </button>
                                     <button @click="downloadFile(JSON.stringify(status, null, 2), 'response.json', 'application/json')" class="inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-[var(--text-primary)] bg-[var(--bg-tertiary)] hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all">
                                         <i class="fas fa-code mr-1"></i> Download JSON
                                     </button>
                                 </div>
                            </div>
                        </div>
                        <!-- Tabs Navigation -->
                        <div class="card">
                            <div class="border-b border-[var(--border-color)] mb-4">
                                <nav class="flex flex-wrap -mb-px space-x-4" aria-label="Tabs">
                                    <button @click="activeTab = 'full'" :class="{'active': activeTab === 'full'}" class="tab">
                                        <i class="fas fa-file-alt"></i> Full Document
                                    </button>
                                    <button @click="activeTab = 'chunks'" :class="{'active': activeTab === 'chunks'}" class="tab">
                                        <i class="fas fa-puzzle-piece"></i> Chunk Pairs
                                    </button>
                                    <button @click="activeTab = 'glossary'" :class="{'active': activeTab === 'glossary'}" class="tab">
                                        <i class="fas fa-book"></i> Glossary
                                    </button>
                                    <button @click="activeTab = 'logs'" :class="{'active': activeTab === 'logs'}" class="tab">
                                        <i class="fas fa-list-ul"></i> Logs
                                    </button>
                                </nav>
                            </div>
                            <!-- Tab Content -->
                            <div class="tab-content">
                                <!-- Full Document View -->
                                <div x-show="activeTab === 'full'">
                                    <template x-if="!status.final_document">
                                        <div class="p-6 text-center text-[var(--text-muted)]">
                                            <div class="text-lg mb-3"><i class="fas fa-hourglass-half fa-spin text-blue-500 mr-2"></i> Translation in progress...</div>
                                            <p class="text-sm">Will update when complete. In the meantime, view the real-time translated chunks or logs for more details.</p>
                                        </div>
                                    </template>
                                    <template x-if="status.final_document">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <div class="flex justify-between items-baseline mb-1">
                                                    <h3 class="text-lg font-semibold"><i class="fas fa-file-alt mr-1"></i> Original</h3>
                                                    <span class="text-xs text-[var(--text-muted)]" x-text="`Words: ${countWords(cleanedOriginalContent)} | Chars: ${cleanedOriginalContent.length}`"></span>
                                                </div>
                                                <textarea readonly :dir="isRtl(inputData.config.source_lang) ? 'rtl' : 'ltr'" x-text="cleanedOriginalContent" rows="20" class="w-full rounded-md shadow-sm sm:text-sm disabled:opacity-100"></textarea>
                                            </div>
                                            <div>
                                                <div class="flex justify-between items-baseline mb-1">
                                                    <h3 class="text-lg font-semibold"><i class="fas fa-language mr-1"></i> Translated</h3>
                                                     <span class="text-xs text-[var(--text-muted)]" x-text="`Words: ${countWords(cleanedTranslatedContent)} | Chars: ${cleanedTranslatedContent.length}`"></span>
                                                </div>
                                                <div :dir="isRtl(inputData.config.target_lang) ? 'rtl' : 'ltr'" class="h-[410px] overflow-y-auto border border-[var(--border-color)] rounded-md p-3 bg-[var(--bg-tertiary)]">
                                                    <pre x-text="cleanedTranslatedContent"></pre>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <!-- Chunk Pairs View -->
                                <div x-show="activeTab === 'chunks'" class="space-y-4 max-h-[500px] overflow-y-auto">
                                    <template x-for="(chunk, index) in status.chunks" :key="index">
                                        <div class="border-b border-[var(--border-color)] pb-4">
                                            <h4 class="text-md font-semibold mb-2"><i class="fas fa-puzzle-piece mr-1"></i> Chunk Pair <span x-text="index + 1"></span></h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <h5 class="text-sm font-medium text-[var(--text-muted)] mb-1"><i class="fas fa-file-alt mr-1"></i> Original</h5>
                                                    <pre :dir="isRtl(inputData.config.source_lang) ? 'rtl' : 'ltr'" class="bg-[var(--bg-tertiary)] rounded p-2" x-text="cleanMarkdown(chunk.original_chunk || '')"></pre>
                                                </div>
                                                <div>
                                                    <h5 class="text-sm font-medium text-[var(--text-muted)] mb-1"><i class="fas fa-language mr-1"></i> Translated</h5>
                                                    <pre :dir="isRtl(inputData.config.target_lang) ? 'rtl' : 'ltr'" class="bg-[var(--bg-tertiary)] rounded p-2" x-text="cleanMarkdown(chunk.translated_chunk || '')"></pre>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                     <p x-show="!status.chunks || status.chunks.length === 0" class="text-center py-4 text-[var(--text-muted)]">
                                         <i class="fas fa-info-circle mr-1"></i> No chunk data available.
                                     </p>
                                </div>
                                <!-- Glossary View -->
                                <div x-show="activeTab === 'glossary'">
                                    <div class="flex justify-between items-center mb-2">
                                        <h3 class="text-lg font-semibold"><i class="fas fa-book mr-1"></i> Translation Glossary</h3>
                                        <span class="text-sm text-[var(--text-muted)]"
                                              x-text="glossaryUsedSource === 'id' ? 'Source: User Selected' :
                                                     (glossaryUsedSource === 'default' ? 'Source: Default Glossary' :
                                                     (glossaryUsedSource === 'direct' ? 'Source: Direct Input (API)' :
                                                     (glossaryUsedSource === 'none' ? 'Source: Automatic Extraction' : 'Source: Unknown')))">
                                        </span>
                                    </div>
                                    <div class="overflow-x-auto bg-[var(--bg-tertiary)] rounded-lg">
                                        <table class="min-w-full divide-y divide-[var(--border-color)]">
                                            <thead class="bg-[var(--bg-secondary)]">
                                                <tr>
                                                    <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Source Term</th>
                                                    <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Target Term</th>
                                                    <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Context</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-[var(--border-color)] bg-[var(--bg-primary)]">
                                                <template x-for="(entry, index) in status.contextualized_glossary" :key="index">
                                                    <tr class="hover:bg-[var(--bg-tertiary)] transition-colors">
                                                        <td class="px-4 py-3 text-sm" :dir="isRtl(inputData.config.source_lang) ? 'rtl' : 'ltr'" x-text="entry.sourceTerm"></td>
                                                        <td class="px-4 py-3 text-sm" :dir="isRtl(inputData.config.target_lang) ? 'rtl' : 'ltr'" x-text="entry.proposedTranslations && entry.proposedTranslations[inputData.config.target_lang]"></td>
                                                        <td class="px-4 py-3 text-sm" x-text="entry.context || '-'"></td>
                                                    </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div x-show="!status.contextualized_glossary || status.contextualized_glossary.length === 0" class="text-center py-4 text-[var(--text-muted)]">
                                        <i class="fas fa-info-circle mr-1"></i> No glossary entries found for this job.
                                    </div>
                                </div>
                                <!-- Logs View -->
                                <div x-show="activeTab === 'logs'">
                                    <h3 class="text-lg font-semibold mb-2"><i class="fas fa-list-ul mr-1"></i> Logs</h3>
                                    <div class="max-h-96 overflow-y-auto bg-[var(--bg-tertiary)] p-3 rounded-lg border border-[var(--border-color)] text-sm font-mono">
                                        <template x-for="(log, index) in logs" :key="index">
                                            <div class="py-1 border-b border-[var(--border-color)] border-opacity-20" x-text="log"></div>
                                        </template>
                                        <div x-show="!logs || logs.length === 0" class="text-center py-4 text-[var(--text-muted)]">
                                            No logs available.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
                <div x-show="!jobId && !isLoading && viewMode === 'form'" class="card text-center p-8">
                    <div class="text-6xl mb-6 text-indigo-600 opacity-50">
                        <i class="fas fa-file-import"></i>
                    </div>
                    <h3 class="text-xl font-medium mb-2">Start a New Translation</h3>
                    <p class="text-[var(--text-muted)] mb-6">Upload a file or paste your content, configure your translation settings, and click "Start Translation".</p>
                </div>
            </div>
        </div>
        
        <!-- Glossary Management View -->
        <div x-show="viewMode === 'glossary'" class="space-y-4 tab-content">
            <div class="max-w-5xl mx-auto">
                <h2 class="text-xl font-semibold mb-6 text-center">
                    <i class="fas fa-book mr-2"></i> Glossary Management
                </h2>
                <!-- Create/Edit Glossary Form -->
                <div class="card">
                    <h3 class="text-lg font-semibold mb-3" x-text="currentGlossary.glossary_id ? 'Edit Glossary' : 'Create New Glossary Table'">
                        <i class="fas fa-edit mr-1"></i> Create New Glossary Table
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label for="glossary_name" class="block text-sm font-medium">
                                <i class="fas fa-tag mr-1"></i> Glossary Table Name:
                            </label>
                            <input type="text" id="glossary_name" x-model="currentGlossary.name" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="Enter a name for this glossary">
                        </div>
                        <div>
                            <label for="glossary-file-upload" class="block text-sm font-medium mb-1">
                                <i class="fas fa-upload mr-1"></i> Upload Glossary JSON File:
                            </label>
                            <p class="text-xs text-[var(--text-muted)] mb-2">Example format: [{"sourceTerm": "example", "proposedTranslations": {"target_lang": "translation"}}, ...]</p>
                            <input id="glossary-file-upload" type="file" @change="handleGlossaryFileUpload($event)" accept=".json" class="block w-full text-sm text-[var(--text-muted)] file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[var(--bg-tertiary)] file:text-[var(--text-primary)] hover:file:bg-opacity-80">
                            <p x-show="glossaryFilename" class="mt-1 text-sm text-[var(--text-muted)]">Selected file: <span x-text="glossaryFilename"></span></p>
                        </div>
                        <!-- New Term Input Section -->
                        <div class="p-3 border border-[var(--border-color)] rounded-lg bg-[var(--bg-tertiary)]">
                            <label class="block text-sm font-medium mb-2">
                                <i class="fas fa-plus-circle mr-1"></i> Add Glossary Terms:
                            </label>
                            <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 items-end">
                                <div class="w-full md:w-2/5">
                                    <label for="new_source_term" class="block text-xs font-medium text-[var(--text-muted)]">Source Term</label>
                                    <input type="text" id="new_source_term" x-model="newTerm.source" class="block w-full rounded-md shadow-sm sm:text-sm" placeholder="Source term">
                                </div>
                                <div class="w-full md:w-2/5">
                                    <label for="new_target_term" class="block text-xs font-medium text-[var(--text-muted)]">Target Term (<span x-text="determineGlossaryTargetLang() || 'target_lang'"></span>)</label>
                                    <input type="text" id="new_target_term" x-model="newTerm.target" class="block w-full rounded-md shadow-sm sm:text-sm" placeholder="Target translation">
                                </div>
                                <button @click="addGlossaryTerm()" :disabled="!newTerm.source || !newTerm.target" class="w-full md:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 transition-all">
                                    <i class="fas fa-plus-circle mr-1"></i> Add Term
                                </button>
                            </div>
                        </div>
                        <!-- Display Added Terms -->
                        <div class="mt-4">
                            <h4 class="text-md font-semibold mb-2">
                                <i class="fas fa-list mr-1"></i> Current Terms (<span x-text="currentGlossary.terms ? currentGlossary.terms.length : 0"></span>):
                            </h4>
                            <div class="max-h-60 overflow-y-auto border border-[var(--border-color)] rounded-lg">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--bg-tertiary)] sticky top-0">
                                        <tr>
                                            <th class="px-4 py-2 text-left text-sm font-medium text-[var(--text-muted)]">Source</th>
                                            <th class="px-4 py-2 text-left text-sm font-medium text-[var(--text-muted)]">Target (<span x-text="determineGlossaryTargetLang() || 'target_lang'"></span>)</th>
                                            <th class="px-4 py-2 text-left text-sm font-medium text-[var(--text-muted)]">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-[var(--border-color)] bg-[var(--bg-primary)]">
                                        <template x-for="(term, index) in currentGlossary.terms" :key="index">
                                            <tr class="hover:bg-[var(--bg-tertiary)] transition-colors">
                                                <td class="px-4 py-2 text-sm" x-text="term.sourceTerm"></td>
                                                <td class="px-4 py-2 text-sm" x-text="term.proposedTranslations['default'] || Object.values(term.proposedTranslations)[0] || ''"></td>
                                                <td class="px-4 py-2 text-sm">
                                                    <button @click="removeGlossaryTerm(index)" class="text-red-600 hover:text-red-900 transition-colors">
                                                        <i class="fas fa-trash-alt"></i> Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                        <template x-if="!currentGlossary.terms || currentGlossary.terms.length === 0">
                                            <tr>
                                                <td colspan="3" class="px-4 py-3 text-center text-sm text-[var(--text-muted)]">
                                                    <i class="fas fa-info-circle mr-1"></i> No terms added yet. Use the fields above or upload a file.
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button @click="saveUserGlossary" :disabled="!currentGlossary.name || !currentGlossary.glossary_json_string" class="inline-flex justify-center items-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                                <i class="fas fa-save mr-1"></i> <span x-text="currentGlossary.glossary_id ? 'Update Glossary' : 'Save New Glossary'">Save New Glossary</span>
                            </button>
                            <button @click="resetCurrentGlossary()" x-show="currentGlossary.glossary_id" class="inline-flex justify-center items-center py-2 px-4 border border-[var(--border-color)] shadow-sm text-sm font-medium rounded-md text-[var(--text-primary)] bg-[var(--bg-tertiary)] hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all">
                                <i class="fas fa-times mr-1"></i> Cancel Edit
                            </button>
                        </div>
                        <div x-show="glossaryError" class="mt-2 text-sm text-red-600" x-text="glossaryError"></div>
                    </div>
                </div>
                <!-- Saved Glossaries List -->
                <div class="card">
                    <h3 class="text-lg font-semibold mb-3">
                        <i class="fas fa-list-alt mr-1"></i> Saved Glossaries
                    </h3>
                    <div class="overflow-x-auto bg-[var(--bg-tertiary)] rounded-lg">
                        <table class="min-w-full divide-y divide-[var(--border-color)]">
                            <thead class="bg-[var(--bg-secondary)]">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Name</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Default</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-[var(--border-color)] bg-[var(--bg-primary)]">
                                <template x-for="glossary in userGlossaries" :key="glossary.glossary_id">
                                    <tr class="hover:bg-[var(--bg-tertiary)] transition-colors">
                                        <td class="px-4 py-3 text-sm" x-text="glossary.name"></td>
                                        <td class="px-4 py-3 text-sm">
                                            <span x-show="glossary.is_default" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                                <i class="fas fa-check mr-1"></i> Default
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-sm space-x-2 whitespace-nowrap">
                                            <button @click="setDefaultUserGlossary(glossary.glossary_id)" x-show="!glossary.is_default" class="text-indigo-600 hover:text-indigo-900 transition-colors">
                                                <i class="fas fa-star mr-1"></i> Set Default
                                            </button>
                                            <button @click="editUserGlossary(glossary.glossary_id)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i> Edit
                                            </button>
                                            <button @click="downloadGlossary(glossary.glossary_id, glossary.name)" class="text-green-600 hover:text-green-900 transition-colors">
                                                <i class="fas fa-download mr-1"></i> Download
                                            </button>
                                            <button @click="deleteUserGlossary(glossary.glossary_id, glossary.name)" class="text-red-600 hover:text-red-900 transition-colors">
                                                <i class="fas fa-trash-alt mr-1"></i> Delete
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    <div x-show="userGlossaries.length === 0" class="text-center py-4 text-[var(--text-muted)]">
                        <i class="fas fa-info-circle mr-1"></i> No glossaries saved yet. Create one using the form above.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Configuration View (LLM + Environment) -->
        <!-- Configuration View (LLM + Environment) -->
        <div x-show="viewMode === 'llm-config'" x-data="{ configTab: 'llm' }" class="tab-content"> <!-- Removed space-y-4 -->
            <div class="max-w-7xl mx-auto flex gap-6"> <!-- Use flexbox for side-by-side layout -->
                <!-- Vertical Configuration Tabs Navigation -->
                <div class="w-1/4 lg:w-1/5 flex-shrink-0"> <!-- Fixed width for nav -->
                     <nav class="flex flex-col space-y-1 sticky top-4" aria-label="Config Tabs">
                        <button
                            @click="configTab = 'llm'"
                            :class="{
                                'bg-[var(--bg-tertiary)] text-[var(--text-primary)] font-semibold border-l-4 border-[var(--link-color)]': configTab === 'llm',
                                'text-[var(--text-muted)] hover:bg-[var(--bg-secondary)] hover:text-[var(--text-primary)] border-l-4 border-transparent': configTab !== 'llm'
                            }"
                            class="w-full text-left py-3 px-4 font-medium text-sm rounded-md transition-colors duration-200 ease-in-out focus:outline-none flex items-center gap-2"
                        >
                            <i class="fas fa-microchip w-5 text-center"></i> LLM Configuration
                        </button>
                        <button
                            @click="configTab = 'env'"
                            :class="{
                                'bg-[var(--bg-tertiary)] text-[var(--text-primary)] font-semibold border-l-4 border-[var(--link-color)]': configTab === 'env',
                                'text-[var(--text-muted)] hover:bg-[var(--bg-secondary)] hover:text-[var(--text-primary)] border-l-4 border-transparent': configTab !== 'env'
                            }"
                            class="w-full text-left py-3 px-4 font-medium text-sm rounded-md transition-colors duration-200 ease-in-out focus:outline-none flex items-center gap-2"
                        >
                            <i class="fas fa-key w-5 text-center"></i> Environment Variables
                        </button>
                    </nav>
                </div>

                <!-- Tab Content Area -->
                <div class="flex-grow min-w-0"> <!-- Allow content to grow -->
                    <!-- LLM Configuration Section -->
                    <div x-show="configTab === 'llm'" class="tab-content space-y-6"> <!-- Add space-y back here -->
                        <div class="card space-y-6"> <!-- Removed grid, card takes full width -->
                            <h3 class="text-lg font-semibold text-center">
                                <i class="fas fa-microchip mr-1"></i> LLM Configuration
                            </h3>
                        <!-- Current Default Configuration -->
                        <div class="p-4 border border-[var(--border-color)] rounded-lg bg-[var(--bg-tertiary)]">
                            <h4 class="text-md font-medium mb-4 text-center">
                                <i class="fas fa-check-circle mr-1"></i> Current Default Configuration
                            </h4>
                            <div x-show="defaultLLMConfig" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="mb-2"><span class="font-medium"><i class="fas fa-link mr-1"></i> API URL:</span> <span x-text="defaultLLMConfig?.api_url || '-'"></span></p>
                                    <p class="mb-2"><span class="font-medium"><i class="fas fa-server mr-1"></i> Provider:</span> <span x-text="defaultLLMConfig?.provider || '-'"></span></p>
                                    <p class="mb-2"><span class="font-medium"><i class="fas fa-brain mr-1"></i> Model:</span> <span x-text="defaultLLMConfig?.model || '-'"></span></p>
                                </div>
                            </div>
                            <div x-show="!defaultLLMConfig" class="text-center py-4 text-[var(--text-muted)]">
                                <i class="fas fa-info-circle mr-1"></i> No default configuration set. Create one using the form.
                            </div>
                        </div>
                        <!-- New Configuration Form -->
                        <div class="p-4 border border-[var(--border-color)] rounded-lg">
                            <h4 class="text-md font-medium mb-4 text-center">
                                <i class="fas fa-plus-circle mr-1"></i> Create New Configuration
                            </h4>
                            <div class="space-y-3">
                                <div>
                                    <label for="api_url" class="block text-sm font-medium">
                                        <i class="fas fa-link mr-1"></i> API URL:
                                    </label>
                                    <input type="text" id="api_url" x-model="newLLMConfig.api_url" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="e.g., http://localhost:8051" value="http://localhost:8051">
                                </div>
                                <div>
                                    <label for="llm_provider" class="block text-sm font-medium">
                                        <i class="fas fa-server mr-1"></i> Provider:
                                    </label>
                                    <select id="llm_provider" x-model="newLLMConfig.provider" @change="updateConfigModels" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm">
                                        <option value="">Select Provider</option>
                                        <template x-for="providerName in Object.keys(availableProviders)" :key="providerName">
                                            <option :value="providerName" x-text="providerName"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label for="model-filter" class="block text-sm font-medium mb-1">
                                        <i class="fas fa-filter mr-1"></i> Filter Models:
                                    </label>
                                    <input
                                        id="model-filter"
                                        type="text"
                                        x-model="modelFilter"
                                        placeholder="Type to filter models..."
                                        class="mb-2 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm"
                                    >
                                </div>
                                <div>
                                    <label for="llm_model" class="block text-sm font-medium">
                                        <i class="fas fa-brain mr-1"></i> Model:
                                    </label>
                                    <select id="llm_model" x-model="newLLMConfig.model" :disabled="!newLLMConfig.provider" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm disabled:opacity-50">
                                        <option value="">Select Model</option>
                                        <template x-for="model in configModels.filter(m => !modelFilter || m.toLowerCase().includes(modelFilter.toLowerCase()))" :key="model">
                                            <option :value="model" x-text="model"></option>
                                        </template>
                                    </select>
                                </div>
                                <!-- Translation Mode Dropdown -->
                                <div>
                                    <label for="llm_translation_mode" class="block text-sm font-medium">
                                        <i class="fas fa-tachometer-alt mr-1"></i> Default Translation Mode:
                                    </label>
                                    <select id="llm_translation_mode" x-model="newLLMConfig.translation_mode" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm">
                                        <option value="deep_mode">Deep Translation</option>
                                        <option value="quick_mode">Quick Translation</option>
                                    </select>
                                    <p class="mt-1 text-xs text-[var(--text-muted)]">Set the default translation mode for this configuration.</p>
                                </div>
                                <!-- Content Chunking Algorithm Dropdown -->
                                <div>
                                    <label for="llm_chunking_algorithm" class="block text-sm font-medium">
                                        <i class="fas fa-puzzle-piece mr-1"></i> Content chunking algorithm:
                                    </label>
                                    <select id="llm_chunking_algorithm" x-model="newLLMConfig.chunking_algorithm" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm">
                                        <option value="smart">Smart paragraph chunking</option>
                                        <option value="line">Line by line chunking</option>
                                        <option value="subtitle_srt">Subtitle (.srt)</option>
                                        <option value="symbol">Symbol separated paragraph</option>
                                    </select>
                                    <p class="mt-1 text-xs text-[var(--text-muted)]">Choose how to chunk and translate your document.</p>
                                    
                                    <!-- Symbol Separators Input (conditionally shown) -->
                                    <div x-show="newLLMConfig.chunking_algorithm === 'symbol'" class="mt-2 p-2 border border-[var(--border-color)] rounded-md bg-[var(--bg-tertiary)]">
                                        <label for="symbol_separators" class="block text-sm font-medium">
                                            <i class="fas fa-list mr-1"></i> Symbol Separators:
                                        </label>
                                        <input type="text" id="symbol_separators" x-model="newLLMConfig.symbol_separators"
                                               placeholder='e.g., ["."]  or  [".", ","]'
                                               class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm"
                                               :class="{'border-red-500': newLLMConfig.chunking_algorithm === 'symbol' && !isValidSymbolSeparators()}">
                                        <p class="mt-1 text-xs text-[var(--text-muted)]">Enter symbols as a JSON array. Examples: ["."] for periods only, [".", ","] for periods and commas.</p>
                                        <p x-show="newLLMConfig.chunking_algorithm === 'symbol' && !isValidSymbolSeparators()" class="mt-1 text-xs text-red-500">
                                            Please enter a valid JSON array of strings. Example: ["."] or [".", ","]
                                        </p>
                                    </div>
                                </div>
                                <!-- Toggle Switch for Set as Default -->
                                <div class="flex items-center justify-between">
                                    <label for="llm_default_toggle" class="text-sm font-medium">Set as default configuration</label>
                                    <button
                                        type="button"
                                        id="llm_default_toggle"
                                        @click="newLLMConfig.set_as_default = !newLLMConfig.set_as_default"
                                        :class="newLLMConfig.set_as_default ? 'bg-indigo-600' : 'bg-gray-200 dark:bg-gray-600'"
                                        class="relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                        role="switch"
                                        :aria-checked="newLLMConfig.set_as_default.toString()"
                                    >
                                        <span class="sr-only">Set as default configuration</span>
                                        <span
                                            aria-hidden="true"
                                            :class="newLLMConfig.set_as_default ? 'translate-x-5' : 'translate-x-0'"
                                            class="pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"
                                        ></span>
                                    </button>
                                </div>
                                <div>
                                    <button @click="saveLLMConfig" :disabled="!canSaveLLMConfig()" class="w-full inline-flex justify-center items-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                                        <i class="fas fa-save mr-1"></i> Save Configuration
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Saved Configurations List -->
                        <div>
                            <h4 class="text-md font-medium mb-3 text-center">
                                <i class="fas fa-list-alt mr-1"></i> Saved Configurations
                            </h4>
                            <div class="overflow-x-auto bg-[var(--bg-tertiary)] rounded-lg">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--bg-secondary)]">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Provider</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Model</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Translation Mode</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Chunking Algorithm</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Default</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-[var(--border-color)] bg-[var(--bg-primary)]">
                                        <template x-for="config in llmConfigs" :key="config.id">
                                            <tr class="hover:bg-[var(--bg-tertiary)] transition-colors">
                                                <td class="px-4 py-3 text-sm" x-text="config.provider"></td>
                                                <td class="px-4 py-3 text-sm" x-text="config.model"></td>
                                                <td class="px-4 py-3 text-sm">
                                                    <span x-show="config.translation_mode === 'deep_mode'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                        <i class="fas fa-brain mr-1"></i> Deep
                                                    </span>
                                                    <span x-show="config.translation_mode === 'quick_mode'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                                                        <i class="fas fa-bolt mr-1"></i> Quick
                                                    </span>
                                                    <span x-show="!config.translation_mode" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                                        <i class="fas fa-brain mr-1"></i> Deep (Default)
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 text-sm">
                                                    <span x-show="config.chunking_algorithm === 'smart'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                                        <i class="fas fa-puzzle-piece mr-1"></i> Smart
                                                    </span>
                                                    <span x-show="config.chunking_algorithm === 'line'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800">
                                                        <i class="fas fa-bars mr-1"></i> Line
                                                    </span>
                                                    <span x-show="config.chunking_algorithm === 'subtitle_srt'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                                                        <i class="fas fa-closed-captioning mr-1"></i> SRT
                                                    </span>
                                                    <span x-show="config.chunking_algorithm === 'symbol'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800">
                                                        <i class="fas fa-paragraph mr-1"></i> Symbol
                                                    </span>
                                                    <span x-show="!config.chunking_algorithm" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                                        <i class="fas fa-puzzle-piece mr-1"></i> Smart (Default)
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 text-sm">
                                                    <span x-show="config.is_default" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                                        <i class="fas fa-check mr-1"></i> Default
                                                    </span>
                                                </td>
                                                <td class="px-4 py-3 text-sm space-x-2">
                                                    <button @click="setDefaultLLMConfig(config.id)" x-show="!config.is_default" class="text-indigo-600 hover:text-indigo-900 transition-colors">
                                                        <i class="fas fa-star mr-1"></i> Set Default
                                                    </button>
                                                    <button @click="editLLMConfig(config)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                        <i class="fas fa-edit mr-1"></i> Edit
                                                    </button>
                                                    <button @click="duplicateLLMConfig(config)" class="text-green-600 hover:text-green-900 transition-colors">
                                                        <i class="fas fa-copy mr-1"></i> Duplicate
                                                    </button>
                                                    <button @click="deleteLLMConfig(config.id)" class="text-red-600 hover:text-red-900 transition-colors">
                                                        <i class="fas fa-trash-alt mr-1"></i> Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                            <div x-show="llmConfigs.length === 0" class="text-center py-4 text-[var(--text-muted)]">
                                <i class="fas fa-info-circle mr-1"></i> No configurations saved yet.
                            </div>
                        </div>
                        </div>
                    </div>
                    <!-- Environment Variables Section -->
                    <div x-show="configTab === 'env'" class="tab-content space-y-6"> <!-- Add space-y back here -->
                        <div class="card space-y-6">
                            <h3 class="text-lg font-semibold text-center">
                                <i class="fas fa-key mr-1"></i> Environment Variables
                            </h3>
                        <!-- Add/Edit Environment Variable Form -->
                        <div class="p-4 border border-[var(--border-color)] rounded-lg">
                            <h4 class="text-md font-medium mb-4 text-center">
                                <i class="fas fa-plus-circle mr-1"></i> Add/Edit Environment Variable
                            </h4>
                            <div class="space-y-3">
                                <div>
                                    <label for="env_key" class="block text-sm font-medium">
                                        <i class="fas fa-key mr-1"></i> Key:
                                    </label>
                                    <input type="text" id="env_key" x-model="newEnvVar.key" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="e.g., OPENAI_API_KEY">
                                </div>
                                <div>
                                    <label for="env_value" class="block text-sm font-medium">
                                        <i class="fas fa-lock mr-1"></i> Value:
                                    </label>
                                    <input type="text" id="env_value" x-model="newEnvVar.value" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="e.g., sk-...">
                                </div>
                                <div>
                                    <label for="env_description" class="block text-sm font-medium">
                                        <i class="fas fa-info-circle mr-1"></i> Description:
                                    </label>
                                    <input type="text" id="env_description" x-model="newEnvVar.description" class="mt-1 block w-full rounded-md shadow-sm focus:ring focus:ring-opacity-50 sm:text-sm" placeholder="e.g., OpenAI API Key for GPT models">
                                </div>
                                <div>
                                    <button @click="saveEnvVariable()" class="w-full inline-flex justify-center items-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                                        <i class="fas fa-save mr-1"></i> Save Environment Variable
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Saved Environment Variables List -->
                        <div>
                            <h4 class="text-md font-medium mb-3 text-center">
                                <i class="fas fa-list-alt mr-1"></i> Saved Environment Variables
                            </h4>
                            <div class="overflow-x-auto bg-[var(--bg-tertiary)] rounded-lg">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--bg-secondary)]">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Key</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Value</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Description</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-[var(--border-color)] bg-[var(--bg-primary)]">
                                        <template x-for="variable in envVariables" :key="variable.id">
                                            <tr class="hover:bg-[var(--bg-tertiary)] transition-colors">
                                                <td class="px-4 py-3 text-sm" x-text="variable.key"></td>
                                                <td class="px-4 py-3 text-sm">
                                                    <span x-text="'‚Ä¢'.repeat(8)"></span>
                                                </td>
                                                <td class="px-4 py-3 text-sm" x-text="variable.description || '-'"></td>
                                                <td class="px-4 py-3 text-sm space-x-2">
                                                    <button @click="editEnvVariable(variable)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                        <i class="fas fa-edit mr-1"></i> Edit
                                                    </button>
                                                    <button @click="deleteEnvVariable(variable.key)" class="text-red-600 hover:text-red-900 transition-colors">
                                                        <i class="fas fa-trash-alt mr-1"></i> Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                            <div x-show="envVariables.length === 0" class="text-center py-4 text-[var(--text-muted)]">
                                <i class="fas fa-info-circle mr-1"></i> No environment variables saved yet.
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Job History View -->
        <div x-show="viewMode === 'history'" class="space-y-4 tab-content">
            <div class="card">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-history mr-2"></i> Translation Job History
                </h2>
                <div class="overflow-x-auto bg-[var(--bg-tertiary)] rounded-lg">
                    <table class="min-w-full divide-y divide-[var(--border-color)]">
                        <thead class="bg-[var(--bg-secondary)]">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Job ID</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Filename</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Languages</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Accent/Style</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Mode</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Chunking Algorithm</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Status</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Created</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Duration</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-[var(--border-color)] bg-[var(--bg-primary)]">
                            <template x-for="job in jobHistory" :key="job.job_id">
                                <tr class="hover:bg-[var(--bg-tertiary)] transition-colors">
                                    <td class="px-4 py-3 text-sm" x-text="job.job_id.substring(0, 8) + '...'"></td>
                                    <td class="px-4 py-3 text-sm" x-text="job.filename ? (job.filename.length > 20 ? job.filename.substring(0, 18) + '...' : job.filename) : '-'"></td>
                                    <td class="px-4 py-3 text-sm" x-text="job.source_lang + ' ‚Üí ' + job.target_lang"></td>
                                    <td class="px-4 py-3 text-sm" x-text="job.target_language_accent || '-'"></td>
                                    <td class="px-4 py-3 text-sm">
                                        <span x-show="job.config_json && JSON.parse(job.config_json).translation_mode === 'deep_mode'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                            <i class="fas fa-brain mr-1"></i> Deep
                                        </span>
                                        <span x-show="job.config_json && JSON.parse(job.config_json).translation_mode === 'quick_mode'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                                            <i class="fas fa-bolt mr-1"></i> Quick
                                        </span>
                                        <span x-show="!job.config_json || !JSON.parse(job.config_json).translation_mode" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                            <i class="fas fa-brain mr-1"></i> Deep
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm">
                                        <span x-show="job.config_json && JSON.parse(job.config_json).chunking_algorithm === 'smart'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                            <i class="fas fa-puzzle-piece mr-1"></i> Smart
                                        </span>
                                        <span x-show="job.config_json && JSON.parse(job.config_json).chunking_algorithm === 'line'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800">
                                            <i class="fas fa-bars mr-1"></i> Line
                                        </span>
                                        <span x-show="job.config_json && JSON.parse(job.config_json).chunking_algorithm === 'subtitle_srt'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                                            <i class="fas fa-closed-captioning mr-1"></i> SRT
                                        </span>
                                        <span x-show="job.config_json && JSON.parse(job.config_json).chunking_algorithm === 'symbol'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800">
                                            <i class="fas fa-paragraph mr-1"></i> Symbol
                                        </span>
                                        <span x-show="!job.config_json || !JSON.parse(job.config_json).chunking_algorithm" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                            <i class="fas fa-puzzle-piece mr-1"></i> Smart
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm">
                                        <span x-show="job.status === 'completed'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                            <i class="fas fa-check mr-1"></i> Completed
                                        </span>
                                        <span x-show="job.status === 'processing'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                            <i class="fas fa-spinner fa-spin mr-1"></i> Processing
                                        </span>
                                        <span x-show="job.status === 'pending'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                                            <i class="fas fa-clock mr-1"></i> Pending
                                        </span>
                                        <span x-show="job.status === 'failed'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                                            <i class="fas fa-exclamation-triangle mr-1"></i> Failed
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-sm" x-text="new Date(job.created_at).toLocaleString()"></td>
                                    <td class="px-4 py-3 text-sm" x-text="job.completed_at && job.started_at ? calculateDurationString(new Date(job.started_at), new Date(job.completed_at)) : '-'"></td>
                                    <td class="px-4 py-3 text-sm space-x-1 whitespace-nowrap">
                                        <button @click="fetchJobDetails(job.job_id)" class="text-indigo-600 hover:text-indigo-900 transition-colors">
                                            <i class="fas fa-eye mr-1"></i> View
                                        </button>
                                        <button x-show="job.status === 'completed'" @click="downloadTranslation(job.job_id)" class="text-green-600 hover:text-green-900 transition-colors">
                                            <i class="fas fa-download mr-1"></i> Download
                                        </button>
                                        <button x-show="job.status === 'completed'" @click="downloadJobGlossary(job.job_id)" class="text-purple-600 hover:text-purple-900 transition-colors">
                                            <i class="fas fa-book-open mr-1"></i> Glossary
                                        </button>
                                        <button @click="deleteJob(job.job_id)" class="text-red-600 hover:text-red-900 transition-colors">
                                            <i class="fas fa-trash-alt mr-1"></i> Delete
                                        </button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                <div x-show="jobHistory.length === 0" class="text-center py-6 text-[var(--text-muted)]">
                    <div class="text-4xl mb-3 opacity-50"><i class="fas fa-history"></i></div>
                    <p>No translation jobs found yet. Start by creating a new translation.</p>
                </div>
            </div>
        </div>
        
        <!-- Job Details View -->
        <div x-show="viewMode === 'job-details'" class="space-y-4 tab-content">
            <div class="card">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-xl font-semibold"><i class="fas fa-file-alt mr-2"></i> Job Details</h2>
                    <button @click="showJobHistory()" class="inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-[var(--text-primary)] bg-[var(--bg-tertiary)] hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all">
                        <i class="fas fa-arrow-left mr-1"></i> Back to History
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 p-4 border border-[var(--border-color)] rounded-lg bg-[var(--bg-tertiary)]">
                    <div>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-fingerprint mr-1"></i> Job ID:</span> <span class="text-sm bg-[var(--bg-secondary)] px-2 py-0.5 rounded" x-text="selectedJob?.job_id"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-file mr-1"></i> Filename:</span> <span x-text="selectedJob?.filename || '-'"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-info-circle mr-1"></i> Status:</span>
                            <span x-show="selectedJob?.status === 'completed'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                <i class="fas fa-check mr-1"></i> Completed
                            </span>
                            <span x-show="selectedJob?.status === 'processing'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                <i class="fas fa-spinner fa-spin mr-1"></i> Processing
                            </span>
                            <span x-show="selectedJob?.status === 'pending'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                                <i class="fas fa-clock mr-1"></i> Pending
                            </span>
                            <span x-show="selectedJob?.status === 'failed'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                                <i class="fas fa-exclamation-triangle mr-1"></i> Failed
                            </span>
                        </p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-calendar-plus mr-1"></i> Created:</span> <span x-text="selectedJob ? new Date(selectedJob.created_at).toLocaleString() : ''"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-play-circle mr-1"></i> Started:</span> <span x-text="selectedJob?.started_at ? new Date(selectedJob.started_at).toLocaleString() : '-'"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-check-circle mr-1"></i> Completed:</span> <span x-text="selectedJob?.completed_at ? new Date(selectedJob.completed_at).toLocaleString() : '-'"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-stopwatch mr-1"></i> Duration:</span> <span x-text="selectedJob?.completed_at && selectedJob?.started_at ? calculateDurationString(new Date(selectedJob.started_at), new Date(selectedJob.completed_at)) : '-'"></span></p>
                    </div>
                    <div>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-globe-americas mr-1"></i> Source Language:</span> <span x-text="selectedJob?.source_lang"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-globe-europe mr-1"></i> Target Language:</span> <span x-text="selectedJob?.target_lang"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-microphone-alt mr-1"></i> Accent/Style:</span> <span x-text="selectedJob?.target_language_accent || '-'"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-server mr-1"></i> Provider:</span> <span x-text="selectedJob?.provider || '-'"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-brain mr-1"></i> Model:</span> <span x-text="selectedJob?.model"></span></p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-tachometer-alt mr-1"></i> Translation Mode:</span>
                            <span x-show="selectedJob?.config?.translation_mode === 'deep_mode'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                <i class="fas fa-brain mr-1"></i> Deep
                            </span>
                            <span x-show="selectedJob?.config?.translation_mode === 'quick_mode'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                                <i class="fas fa-bolt mr-1"></i> Quick
                            </span>
                            <span x-show="!selectedJob?.config?.translation_mode" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                <i class="fas fa-brain mr-1"></i> Deep (Default)
                            </span>
                        </p>
                        <p class="mb-2"><span class="font-medium"><i class="fas fa-puzzle-piece mr-1"></i> Chunking Algorithm:</span>
                            <span x-show="selectedJob?.config?.chunking_algorithm === 'smart'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                <i class="fas fa-puzzle-piece mr-1"></i> Smart
                            </span>
                            <span x-show="selectedJob?.config?.chunking_algorithm === 'line'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800">
                                <i class="fas fa-bars mr-1"></i> Line
                            </span>
                            <span x-show="selectedJob?.config?.chunking_algorithm === 'subtitle_srt'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                                <i class="fas fa-closed-captioning mr-1"></i> SRT
                            </span>
                            <span x-show="selectedJob?.config?.chunking_algorithm === 'symbol'" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800">
                                <i class="fas fa-paragraph mr-1"></i> Symbol
                            </span>
                            <span x-show="!selectedJob?.config?.chunking_algorithm" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                <i class="fas fa-puzzle-piece mr-1"></i> Smart (Default)
                            </span>
                        </p>
                    </div>
                </div>
                <div x-show="selectedJob?.status === 'processing'" class="mb-4">
                    <p class="mb-1">Progress: <strong x-text="selectedJob?.current_step || 'Processing'"></strong></p>
                    <div class="w-full bg-[var(--bg-tertiary)] rounded-full h-2.5 mb-2 overflow-hidden">
                        <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" :style="`width: ${selectedJob?.progress_percent || 0}%`"></div>
                    </div>
                </div>
                <div x-show="selectedJob?.error_info" class="p-4 bg-red-100 border border-red-400 text-red-700 rounded mb-4">
                    <h3 class="text-md font-semibold mb-1"><i class="fas fa-exclamation-triangle mr-1"></i> Error:</h3>
                    <p class="text-sm" x-text="selectedJob?.error_info"></p>
                </div>
                <div x-show="selectedJob?.status === 'completed' || selectedJob?.status === 'failed'" class="mb-4 flex flex-wrap gap-2">
                    <button x-show="selectedJob?.status === 'completed'" @click="downloadTranslation(selectedJob?.job_id)" class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all">
                        <i class="fas fa-download mr-1"></i> Download Translation
                    </button>
                    <button x-show="selectedJob?.status === 'completed'" @click="downloadJobGlossary(selectedJob?.job_id)" class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all">
                        <i class="fas fa-book-open mr-1"></i> Download Glossary
                    </button>
                    <button @click="deleteJob(selectedJob?.job_id); showJobHistory()" class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all">
                        <i class="fas fa-trash-alt mr-1"></i> Delete Job
                    </button>
                </div>
                
                <!-- Include the same tabs as in the translation view -->
                <div x-show="status.final_document || status.chunks || selectedJob?.chunks">
                    <div class="border-b border-[var(--border-color)] mb-4">
                        <nav class="flex flex-wrap -mb-px space-x-4" aria-label="Tabs">
                            <button @click="activeTab = 'full'" :class="{'active': activeTab === 'full'}" class="tab">
                                <i class="fas fa-file-alt"></i> Full Document
                            </button>
                            <button @click="activeTab = 'chunks'" :class="{'active': activeTab === 'chunks'}" class="tab">
                                <i class="fas fa-puzzle-piece"></i> Chunk Pairs
                            </button>
                            <button @click="activeTab = 'glossary'" :class="{'active': activeTab === 'glossary'}" class="tab">
                                <i class="fas fa-book"></i> Glossary
                            </button>
                            <button @click="activeTab = 'logs'" :class="{'active': activeTab === 'logs'}" class="tab">
                                <i class="fas fa-list-ul"></i> Logs
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Full Document View -->
                        <div x-show="activeTab === 'full'">
                            <template x-if="status.final_document || selectedJob?.final_document">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <div class="flex justify-between items-baseline mb-1">
                                            <h3 class="text-lg font-semibold"><i class="fas fa-file-alt mr-1"></i> Original</h3>
                                            <span class="text-xs text-[var(--text-muted)]" x-text="`Words: ${countWords(selectedJob?.original_content || '')} | Chars: ${(selectedJob?.original_content || '').length}`"></span>
                                        </div>
                                        <textarea readonly :dir="isRtl(selectedJob?.source_lang) ? 'rtl' : 'ltr'" x-text="selectedJob?.original_content" rows="20" class="w-full rounded-md shadow-sm sm:text-sm disabled:opacity-100"></textarea>
                                    </div>
                                    <div>
                                        <div class="flex justify-between items-baseline mb-1">
                                            <h3 class="text-lg font-semibold"><i class="fas fa-language mr-1"></i> Translated</h3>
                                            <span class="text-xs text-[var(--text-muted)]" x-text="`Words: ${countWords(status.final_document || selectedJob?.final_document || '')} | Chars: ${(status.final_document || selectedJob?.final_document || '').length}`"></span>
                                        </div>
                                        <div :dir="isRtl(selectedJob?.target_lang) ? 'rtl' : 'ltr'" class="h-[410px] overflow-y-auto border border-[var(--border-color)] rounded-md p-3 bg-[var(--bg-tertiary)]">
                                            <pre x-text="cleanMarkdown(status.final_document || selectedJob?.final_document || '')"></pre>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="!status.final_document && !selectedJob?.final_document" class="text-center py-6 text-[var(--text-muted)]">
                                <i class="fas fa-info-circle mr-1"></i> No document data available.
                            </div>
                        </div>
                        
                        <!-- Chunk Pairs View -->
                        <div x-show="activeTab === 'chunks'" class="space-y-4 max-h-[500px] overflow-y-auto">
                            <template x-for="(chunk, index) in selectedJob?.chunks || status.chunks" :key="index">
                                <div class="border-b border-[var(--border-color)] pb-4">
                                    <h4 class="text-md font-semibold mb-2"><i class="fas fa-puzzle-piece mr-1"></i> Chunk Pair <span x-text="index + 1"></span></h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <h5 class="text-sm font-medium text-[var(--text-muted)] mb-1"><i class="fas fa-file-alt mr-1"></i> Original</h5>
                                            <pre :dir="isRtl(selectedJob?.source_lang) ? 'rtl' : 'ltr'" class="bg-[var(--bg-tertiary)] rounded p-2" x-text="cleanMarkdown(chunk.original_chunk || '')"></pre>
                                        </div>
                                        <div>
                                            <h5 class="text-sm font-medium text-[var(--text-muted)] mb-1"><i class="fas fa-language mr-1"></i> Translated</h5>
                                            <pre :dir="isRtl(selectedJob?.target_lang) ? 'rtl' : 'ltr'" class="bg-[var(--bg-tertiary)] rounded p-2" x-text="cleanMarkdown(chunk.translated_chunk || '')"></pre>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="(!selectedJob?.chunks || selectedJob?.chunks.length === 0) && (!status.chunks || status.chunks.length === 0)" class="text-center py-4 text-[var(--text-muted)]">
                                <i class="fas fa-info-circle mr-1"></i> No chunk data available.
                            </div>
                        </div>
                        
                        <!-- Glossary View -->
                        <div x-show="activeTab === 'glossary'">
                            <h3 class="text-lg font-semibold mb-2"><i class="fas fa-book mr-1"></i> Translation Glossary</h3>
                            <div class="overflow-x-auto bg-[var(--bg-tertiary)] rounded-lg">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--bg-secondary)]">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Source Term</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Target Term</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-[var(--text-muted)]">Context</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-[var(--border-color)] bg-[var(--bg-primary)]">
                                        <template x-for="(entry, index) in selectedJob?.glossary || status.contextualized_glossary" :key="index">
                                            <tr class="hover:bg-[var(--bg-tertiary)] transition-colors">
                                                <td class="px-4 py-3 text-sm" :dir="isRtl(selectedJob?.source_lang) ? 'rtl' : 'ltr'" x-text="entry.source_term || entry.sourceTerm"></td>
                                                <td class="px-4 py-3 text-sm" :dir="isRtl(selectedJob?.target_lang) ? 'rtl' : 'ltr'" x-text="entry.target_term || (entry.proposedTranslations && entry.proposedTranslations[selectedJob?.target_lang])"></td>
                                                <td class="px-4 py-3 text-sm" x-text="entry.context || '-'"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                            <div x-show="(!selectedJob?.glossary || selectedJob?.glossary.length === 0) && (!status.contextualized_glossary || status.contextualized_glossary.length === 0)" class="text-center py-4 text-[var(--text-muted)]">
                                <i class="fas fa-info-circle mr-1"></i> No glossary entries found for this job.
                            </div>
                        </div>
                        
                        <!-- Logs View -->
                        <div x-show="activeTab === 'logs'">
                            <h3 class="text-lg font-semibold mb-2"><i class="fas fa-list-ul mr-1"></i> Logs</h3>
                            <div class="max-h-96 overflow-y-auto bg-[var(--bg-tertiary)] p-3 rounded-lg border border-[var(--border-color)] text-sm font-mono">
                                <template x-for="(log, index) in selectedJob?.logs" :key="index">
                                    <div class="py-1 border-b border-[var(--border-color)] border-opacity-20" x-text="`${new Date(log.created_at).toLocaleTimeString()} [${log.level}] ${log.message}`"></div>
                                </template>
                                <div x-show="!selectedJob?.logs || selectedJob?.logs.length === 0" class="text-center py-4 text-[var(--text-muted)]">
                                    <i class="fas fa-info-circle mr-1"></i> No logs available.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>LLM Powered In-game Text Translator</p>
            <p class="mt-1">
            </p>
        </div>
    </div>
    
    <script src="/static/js/app.js"></script>
    
    <script>
        // Add this function to your app.js or include it here
        function resetTranslation() {
            // Reset translation-related variables
            if (typeof translationApp === 'function') {
                const app = Alpine.store('translationApp');
                if (app) {
                    app.jobId = null;
                    app.status = {};
                    app.logs = [];
                    app.isLoading = false;
                    app.activeTab = 'full';
                    app.inputData.original_content = '';
                    app.originalFilename = '';
                }
            }
        }
    </script>
</body>
</html>